/*! risk-map-0.0.1 built on Tue Jul 30 2013 17:08:39 by Gleb Bahmutov */
!function(a){function b(b,c){a.json(b,c)}function c(b){g=f=b;var c=l.nodes(f);c=c.filter(function(a){return!!a.name});var h=m.selectAll("g").data(c).enter().append("svg:g").attr("class","cell").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).on("click",function(a){return e(g==a.parent?f:a.parent)}),i=a.interpolateHsl("hsl(0, 100%, 50%)","hsl(0, 100%, 100%)"),j=a.scale.linear().domain([0,100]).range([0,1]);h.append("svg:rect").attr("width",function(a){return a.dx-1}).attr("height",function(a){return a.dy-1}).style("fill",function(a){var b=a.coverage?+a.coverage:0,c=j(b);return i(c)}),h.append("svg:title").text(function(a){return a.name+"\n"+a.loc+" lines of code\n"+a.cyclomatic+" cyclomatic complexity\n"+a.halstead+" Halstead difficulty\n"+a.coverage+"% unit test coverage"}),h.append("svg:text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(a){return a.name}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),a.select(window).on("click",function(){e(f)}),a.select("select").on("change",function(){var a=this.value,b=d.bind(null,a);l.value(b).nodes(f),e(g)})}function d(a,b){return b[a]?b[a]:1}function e(b){var c=h/b.dx,d=i/b.dy;j.domain([b.x,b.x+b.dx]),k.domain([b.y,b.y+b.dy]);var e=m.selectAll("g.cell").transition().duration(a.event.altKey?7500:750).attr("transform",function(a){return"translate("+j(a.x)+","+k(a.y)+")"});e.select("rect").attr("width",function(a){return c*a.dx-1}).attr("height",function(a){return d*a.dy-1}),e.select("text").attr("x",function(a){return c*a.dx/2}).attr("y",function(a){return d*a.dy/2}).style("opacity",function(a){return c*a.dx>a.w?1:0}),g=b,a.event.stopPropagation()}var f,g,h=.8*window.innerWidth,i=.75*window.innerHeight,j=a.scale.linear().range([0,h]),k=a.scale.linear().range([0,i]);a.scale.category20c();var l=a.layout.treemap().round(!1).size([h,i]).sticky(!0).value(d.bind(null,"loc")),m=a.select("#body").append("div").attr("class","chart").style("width",h+"px").style("height",i+"px").append("svg:svg").attr("width",h).attr("height",i).append("svg:g").attr("transform","translate(.5,.5)");b("risk.json",c)}(d3);