/*! risk-map-0.0.1 built on Mon Jul 29 2013 19:53:06 by Gleb Bahmutov */
!function(a){function b(b,c){a.json(b,c)}function c(b){g=f=b;var c=m.nodes(f);c=c.filter(function(a){return!!a.name});var h=n.selectAll("g").data(c).enter().append("svg:g").attr("class","cell").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).on("click",function(a){return e(g==a.parent?f:a.parent)});h.append("svg:rect").attr("width",function(a){return a.dx-1}).attr("height",function(a){return a.dy-1}).style("fill",function(a){return l(a.parent.name)}),h.append("svg:text").attr("x",function(a){return a.dx/2}).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(a){return a.name}).style("opacity",function(a){return a.w=this.getComputedTextLength(),a.dx>a.w?1:0}),a.select(window).on("click",function(){e(f)}),a.select("select").on("change",function(){var a=this.value,b=d.bind(null,a);m.value(b).nodes(f),e(g)})}function d(a,b){return b[a]?b[a]:1}function e(b){var c=h/b.dx,d=i/b.dy;j.domain([b.x,b.x+b.dx]),k.domain([b.y,b.y+b.dy]);var e=n.selectAll("g.cell").transition().duration(a.event.altKey?7500:750).attr("transform",function(a){return"translate("+j(a.x)+","+k(a.y)+")"});e.select("rect").attr("width",function(a){return c*a.dx-1}).attr("height",function(a){return d*a.dy-1}),e.select("text").attr("x",function(a){return c*a.dx/2}).attr("y",function(a){return d*a.dy/2}).style("opacity",function(a){return c*a.dx>a.w?1:0}),g=b,a.event.stopPropagation()}var f,g,h=.8*window.innerWidth,i=.75*window.innerHeight,j=a.scale.linear().range([0,h]),k=a.scale.linear().range([0,i]),l=a.scale.category20c(),m=a.layout.treemap().round(!1).size([h,i]).sticky(!0).value(d.bind(null,"loc")),n=a.select("#body").append("div").attr("class","chart").style("width",h+"px").style("height",i+"px").append("svg:svg").attr("width",h).attr("height",i).append("svg:g").attr("transform","translate(.5,.5)");b("risk.json",c)}(d3);